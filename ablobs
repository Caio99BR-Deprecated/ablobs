#!/bin/bash
# Empty variables
foundc=0
nfoundc=0
_lib_dir="lib/"
_vendor_lib_dir="vendor/lib/"
_lib_list="/tmp/t-sh.txt"
_missing="$(pwd)/t-sh-missing-files.txt"

printf '  WARNING\n'
printf "Make sure you are inside of '/system' dir\n"
printf "If not, the script will be useless\n"
printf '  WARNING\n'
read -p "Press any key to continue..." -s ask
printf '\n'

echo "# Auto generated by Android Blob Utility Script" > ${_missing}

objdump -x $(find .) | grep NEEDED | sort | uniq | sed 's/  NEEDED               //' > ${_lib_list}

while IFS= read -r _file
do
	if [[ -e ${_lib_dir}/${_file} ]]
	then
		foundc=$((foundc + 1))
	else
		if [[ -e ${_vendor_lib_dir} ]]
		then
			if [[ -e ${_vendor_lib_dir}/${_file} ]]
			then
				foundc=$((foundc + 1))
			else
				printf '%s not found in %s, neither in %s\n' "${_file}" "${_lib_dir}" "${_vendor_lib_dir}" | tee -a ${_missing}
				nfoundc=$((nfoundc + 1))
			fi
		else
			printf '%s not found in %s\n' "${_file}" "${_lib_dir}" | tee -a ${_missing}
			nfoundc=$((nfoundc + 1))
		fi
	fi
done < "${_lib_list}"

printf 'Race results:\n'
printf '    Found: %s\n' "${foundc}"
printf '  Missing: %s\n' "${nfoundc}"
printf 'Missing files list saved on:\n'
printf '           %s\n' "${_missing}"

printf 'Thanks for use this script :)\n'
printf 'Made by Caio99BR\n'
